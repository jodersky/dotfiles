#!/bin/bash
#
# millcfg - install mill and generate a starter mill configuration
#
set -o errexit

# Latest mill version
latest_tag=$(curl -sS https://api.github.com/repos/com-lihaoyi/mill/releases/latest | jq -r '.tag_name')

curl -L "https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/$latest_tag/mill-dist-$latest_tag-mill.sh" -o mill

chmod +x mill

cat > build.mill << EOF
//| mill-version: $latest_tag

import mill.*, scalalib.*, scalafmt.*

object app extends ScalaModule with ScalafmtModule:

  def scalaVersion = "3.7.4"

  object test extends ScalaTests:
    def testFramework = "utest.runner.Framework"
    def mvnDeps = Seq(
      mvn"com.lihaoyi::utest::0.9.1"
    )
EOF

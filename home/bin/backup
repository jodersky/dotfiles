#!/bin/bash
set -e

device=/dev/sdb
mapped=backup

case "$1" in
    mount)
	echo $(pass other/backup) | sudo cryptsetup open --type luks "$device" "$mapped"
	sudo mount /dev/mapper/"$mapped" /mnt
	;;
    umount)
	sudo umount /mnt
	sudo cryptsetup close "$mapped"
	;;
    *)
	echo "Unknown argument $1"
	echo "Usage: $0 [mount | umount]"
	exit 1
	;;
esac
